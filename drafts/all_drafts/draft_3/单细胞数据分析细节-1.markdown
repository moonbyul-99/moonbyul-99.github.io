
## HVG 筛选 

scanpy中提供三种筛选方式 seurat, cell_ranger, seurat_v3, 这三种方法的具体操作过程如下:

- seurat
   输入对数标准化的数据，对每个基因，计算其均值$\mu_g$ 和 分散度 $u_g = \frac{var_g}{\mu_g}$。 之后根据所有基因的均值进行分组，分为K组。对每个箱内的基因的分散度做$z$-tranform，即
   $$\bar{u_g} = \frac{u_g - \mu_{k}}{\sigma_{k}}$$
    这里$\mu_{k},\sigma_k$是第k组内基因的表达量的均值和标准差。之后根据转换后的分散度对基因进行排序筛选，选择top-N个或者通过阈值的基因。

- cell_ranger
  输入对数标准化的基因，同样计算均值和分散度并分组，但是组内的标准化方式不同，即
  $$\bar{u_g} = \frac{\vert u_g - \mu_{med}\vert }{\sigma_{med}}$$ 

  这里$\mu_{med},\sigma_{med}$是第k组内每个基因的平均表达量的中位数和表达量标准差的中位数
- seurat_v3

    输入为原始的计数矩阵。对每个基因计算其均值$\mu_g$和方差$var_g$，之后对均值和方差做$\log_{10}$变换。对变换后的方差和均值做二次曲线拟合，得到拟合去先后，对数据做如下变换
    $$z_{ij}= \frac{x_{ij} - \bar{x_i}}{\sigma_i}$$
    这里$x_{ij}$为基因i在细胞j内的表达量，$\sigma_i$为根据基因i的均值和二次曲线预测出的方差。最后，在上述标准化的数据$Z$中，计算每个基因表达量的方差，按照方差大小筛选基因